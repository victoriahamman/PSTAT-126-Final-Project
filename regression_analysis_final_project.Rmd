---
title: "Regression Analysis Final Project"
author: "Victoria Hamman"
date: "`r Sys.Date()`"
output:
  html_document:
    df_print: paged
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Part 1: Data Description and Descriptive Statistics

1) Select Random Sample

```{r}
library(dplyr)
library(GGally)
#load in csv file
Diamonds_Prices <- read.csv("~/PSTAT/PSTAT 126/Final_Project/Diamonds Prices2022.csv", stringsAsFactors=T)

#select random sample of 1000 rows
set.seed(100)
rand_sample <- Diamonds_Prices[sample(1000), ]

```

2) Describe all the variables

```{r}
summary(rand_sample)
str(rand_sample)
```
Cut, color, and clarity are categorical variables. 
X, carat, depth, table, price, x, y, and z are quantitative variables.

```{r}
# histograms for continuous quantitative variables
hist(rand_sample$carat, xlab="Carat", main="Histogram of Carat")
hist(rand_sample$depth, xlab="Depth", main="Histogram of Depth")
hist(rand_sample$table, xlab="Table Size", main="Histogram of Table Size")
hist(rand_sample$price, xlab="Price", main="Histogram of Price")
hist(rand_sample$x, xlab="x", main="Histogram of x length")
hist(rand_sample$y, xlab="y", main="Histogram of y length")
hist(rand_sample$z, xlab="z", main="Histogram of z length")
```
The distributions of lengths x, y, and z are nearly identical with a large peak at approximately 75% of the range. Carat and depth are more normally distributed, with peaks around the middle of their range. Table size is heavily right-skewed. Price has two peaks of small ranges. The first is at the very beginning of the overall range, and the second is at the very end.

```{r}
#barplots for categorical variables
barplot(table(rand_sample$cut), main="Plot of Cut")
barplot(table(rand_sample$color), main="Plot of Color")
barplot(table(rand_sample$clarity), main="Plot of Clarity")
```
Cut is left-skewed and peaks at "Ideal". Color is right-skewed with a peak at E. Clarity has two peaks at "Sl1" and "VS2".

3) Determine correlation between chosen variables
```{r}
#3 quantitative variables: carat, table, price
#2 categorical variables: cut, clarity
Diamonds <- dplyr::select(rand_sample, carat, cut, clarity, table, price)
head(Diamonds)

#correlation for numerical variables
#scatter plot
diamonds_subset <- Diamonds %>%
  select(where(is.numeric)) 
ggpairs(
  diamonds_subset,
  title = "Scatterplot Matrix of Numerical Variables and Price",
  progress = FALSE
)
cor(diamonds_subset)
```

Both categorical variables (cut and clarity) are correlated to price. 

The quantitative variable "carat" is heavily correlated to price as the correlation value is very high at 0.857. The other quantitative variable "table" does not have a strong correlation with price, as its correlation value is only 0.068. 

4) Run the MLR Model using all the variables and its summary.
```{r}
full_model <- lm(price ~ ., data=Diamonds)
summary(aov(full_model))
```

5) Comment on anything of interest from this part. 

One thing that surprised me was how little correlated table was with price. Table size should be related to the size of the diamond. Therefore, if the table is bigger, the diamond would be expected to be bigger and therefore more valuable. When considering this, the very low correlation is surprising. The regression summary relates to this because, even though it is significant, it is much less significant/a contributing factor to price than everything else is. Everything else appears as I expected it to.

\newpage

# PART 2: Simple Linear Regression

1) Choose one predictor and one response. Conduct simple linear analysis on it.
```{r}
# choose response: price and predictor: carat

#run simple linear regression
simple <- lm(price ~ carat, data = Diamonds)
summary(simple)

#confidence interval for 0.05 significance level
confint(simple, level=0.95)

#prediction interval
predict(simple, newdata=data.frame(carat=0.75), interval='prediction', level=0.95)

#plot 
plot(Diamonds$carat, Diamonds$price, xlab="Carat", ylab="Price",
     main="Price vs Carat")
abline(simple, col='blue', lwd=2)
```

2) Examine and interpret the result of the simple linear regression analysis.

- Intercept: When carat is 0, price is -64.65.
- Carat coefficient: When carat is increased by 1, price increases by 3686.73 dollars on average. 

- Hypothesis testing:
  $H_0$: $B_j = 0$: Carat is not a significant predictor of price.
  $H_A$: $B_j \ne 0$: Carat is a significant predictor of price.

- As the t-value for carat is 52.667, which is large, and has a very small p-value of <2.2e-16, we have evidence to reject the null. Carat does has a highly significant effect on price. 

- $R^2_{adj}$: $R^2_{adj} =  0.7351$, which is very close to $R^2 = 0.7354$. This implies that there are no predictors in the model that shouldn't be included, meaning carat should be included because it is a significant predictor of price. As carat is the only predictor in the model, this means that carat accounts for the majority of the variation in price. 

- RSE: The average error in the model from predicted values to observed values is 432.1 for 998 degrees of freedom (1000 samples). 

- Overall model significance: The F-statistic is 2774 on 1 predictor and 998 degrees of freedom. This very large value alongside the very small p-value of <2.2e-16 shows that the overall model is very significant and the one predictor (carat) has a significant effect on the response (price).

- Confidence Interval for slope: [3549.3685, 3824.10028]

- Prediction value of price: 2700.399
  95% prediction interval: [1852.037, 3548.76]
  
- Plot: The plot with regression line shows that price is clustered on the low end of carat until about 0.45 carat. After this, price is clustered (but more spread out) at carat higher than 0.45. 


3) 


